# ==========================
# 1. General Settings
# ==========================
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
set -g focus-events on
set -g default-shell /bin/zsh

# Fix delay for escape key (mimics tmux-sensible)
set -s escape-time 0

# Increase history limit (mimics tmux-sensible)
set -g history-limit 50000

# Increase display time for messages (4s)
set -g display-time 4000

# Refresh 'status-left' and 'status-right' more often
set -g status-interval 5

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Window Naming (Always use directory name)
set -g automatic-rename on
set -g automatic-rename-format '#{b:pane_current_path}'

# ==========================
# 2. Key Bindings
# ==========================
# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Pane resizing (Prefix + H/J/K/L)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window management
bind -r < swap-window -d -t -1
bind -r > swap-window -d -t +1

# Return to previous tab
bind Tab last-window

# Quick window selection (Prefix + Ctrl-h / Ctrl-l)
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# Mouse Support
set -g mouse on

# ==========================
# 3. Vim-Tmux Navigator (Manual Implementation)
# ==========================
# This allows using Ctrl+h/j/k/l to switch between tmux panes AND vim splits
# without the prefix key.

is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'

# Standard tmux pane switching using Prefix + h/j/k/l (Your fallback)
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R

# ==========================
# 4. Copy Mode (Replaces tmux-yank)
# ==========================
# Use vi keys in copy mode
setw -g mode-keys vi

# Bind 'v' to begin selection (like Vim)
bind -T copy-mode-vi v send-keys -X begin-selection

# Bind 'y' to copy (this depends on your OS)
# For Linux (xclip):
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i"
# If you are on Wayland use: "wl-copy"
# If you are on macOS use: "pbcopy"

# ==========================
# 5. Visual Settings (One Dark Theme)
# ==========================
set -g status-style "bg=#121212,fg=#abb2bf"
set -g pane-border-style "fg=#5c6370"
set -g pane-active-border-style "fg=#56b6c2"
set -g window-status-separator ""
set -g status-position top
set -g status-justify centre

set -g status-left-length 100
set -g status-right-length 100
set -g status-left "#[fg=#98c379]█#[fg=#282c34,bg=#98c379] #S #[fg=#98c379,bg=#282c34]"
set -g status-right "#[fg=#61afef,bg=#121212]#[fg=#282c34,bg=#61afef] %H:%M #[fg=#61afef]"

# Fixed Window Status to always show Directory Name
set -g window-status-format "#[fg=#5c6370] #I:#{b:pane_current_path} "
set -g window-status-current-format "#[fg=#61afef]#[fg=#282c34,bg=#61afef] #I:#{b:pane_current_path} #[fg=#61afef,bg=#282c34]"

# Message style
set -g message-style "bg=#e5c07b,fg=#282c34"
set -g mode-style "bg=#61afef,fg=#282c34"
set -g clock-mode-colour "#56b6c2"

# ==========================
# 6. Session Management Note
# ==========================
# tmux-resurrect and tmux-continuum cannot be "inlined" easily.
# If you need session saving without TPM, you must manually clone the repo:
# git clone https://github.com/tmux-plugins/tmux-resurrect ~/.tmux/tmux-resurrect
# And uncomment the line below:
# run-shell ~/.tmux/tmux-resurrect/resurrect.tmux
